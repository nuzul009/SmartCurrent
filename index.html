<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { background-color: #121212; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; overflow: hidden; }
        .container { display: flex; flex-direction: column; align-items: center; }
        .current-value { font-size: 24px; color: #00e5ff; margin-bottom: 10px; font-weight: bold; }
        .chart-wrapper { position: relative; height: 70vh; width: 100%; }
    </style>
</head>
<body>

    <div class="container">
        <div class="current-value" id="valDisplay">0.000 A</div>
        <div class="chart-wrapper">
            <canvas id="leakChart"></canvas>
        </div>
    </div>

    <script>
        // --- KONFIGURASI FIREBASE ---
        // Ganti dengan data dari Firebase Console -> Project Settings
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            authDomain: "project-kamu.firebaseapp.com",
            databaseURL: "https://project-kamu-default-rtdb.firebaseio.com",
            projectId: "project-kamu",
            storageBucket: "project-kamu.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:12345:web:abcde"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- SETUP CHART ---
        const ctx = document.getElementById('leakChart').getContext('2d');
        let dataPoints = [];
        let labels = [];

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Arus Bocor (A)',
                    data: dataPoints,
                    borderColor: '#00e5ff',
                    backgroundColor: 'rgba(0, 229, 255, 0.1)',
                    fill: true,
                    tension: 0.3,
                    borderWidth: 3,
                    pointRadius: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { 
                        beginAtZero: true,
                        suggestedMax: 0.1, // Skala awal 0.1 Ampere
                        grid: { color: '#2c2c2c' },
                        ticks: { color: '#888', callback: (value) => value + ' A' }
                    },
                    x: { display: false }
                },
                plugins: { legend: { display: false } }
            }
        });

        // --- LISTEN FIREBASE REAL-TIME ---
        // Asumsi data disimpan di path "monitoring/arus"
        db.ref('monitoring/arus').on('value', (snapshot) => {
            const rawValue = snapshot.val();
            const value = parseFloat(rawValue).toFixed(3); // Ambil 3 angka di belakang koma (mA ke A)
            
            document.getElementById('valDisplay').innerText = value + " A";

            if (dataPoints.length > 25) {
                dataPoints.shift();
                labels.shift();
            }

            dataPoints.push(value);
            labels.push(new Date().toLocaleTimeString());
            chart.update('none'); // Update tanpa animasi transisi agar lebih ringan
        });
    </script>
</body>
</html>
